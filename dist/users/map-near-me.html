<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nearby Workers</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="map-near-me.css" />
    <!-- Link to the external CSS file -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  </head>
  <body>
    <header class="header">
      <button class="back-button" onclick="history.back()">
        ← Nearby Workers
      </button>
      <div class="search-bar">
        <input
          id="workerSearch"
          type="text"
          placeholder="Find workers nearby"
        />
      </div>
    </header>

    <div id="map"></div>

    <footer class="footer">
      <a href="home.html" class="nav-item active">
        <img
          src="https://blogger.googleusercontent.com/img/a/AVvXsEimOlv-VSNFOi-pnlgq0Jtsvf9bDZsF3eIHxbvyONJYAT-kPHUH3dXtjU8yGc6NajD7iNAiX-ekL263ogP5EoznWraZIprkPREk47X_266_Dnx8-4XC1XidHBLY-fgRyeZN8BM37W3Va5U54n39UAgRB1hrgNZ3dcvDImmheM2plajp1WfQ4HvYLk8IGA"
          alt="Home"
        />
        <p>Home</p>
      </a>
      <a href="bookings.html" class="nav-item">
        <img
          src="https://blogger.googleusercontent.com/img/a/AVvXsEhld8IIFBvzz1Dxj82boSjt1EvfnO7l6x2G0bPnC1cyH4bfgk4OV-GzxtLiB5suaUl9CSmM0-1wUkRwUmxkkXvzBOpmgiH3G-i6k-mFRziVwk8yX_qYcuf6yBZpN8p-Rqgo3hEewcdd4c0VtpeYa1hg7bYAR2PQ5tunAraQcdAZryjaaHJU8msmmTz2Zg"
          alt="Bookings"
        />
        <p>Bookings</p>
      </a>
      <a href="worker-messages.html" class="nav-item">
        <img
          src="https://blogger.googleusercontent.com/img/a/AVvXsEh7XVqIv5prwkdy7ZbYIlN5enr4v8raZNTrU8xdBTZU6OzQBV3SgSQCfEUw1C69HESGPLwG5a4q1c5Ed_Uk0yHYXs5WEU9J_eigAzzfJDmZIRHdgVU9BT593ybmTclAeysJ14EBNVyN8Mc9_7eKxqxt8IezQWCLoCID0FYJ_WbImPH3IeMDd6YYnwNw-w"
          alt="Messages"
        />
        <p>Messages</p>
      </a>
      <a href="logged-out.html" class="nav-item">
        <img
          src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgqFjUEO0myZ4ieBl8gW4sPqvFZmg4z1QgC4Etu5hVupE1i2-wv787t2SrHXXOhjG1WIzKY-kJaNG2cQ3atOU818oAZChGNwQ65f0f4YieU2b2WFogQuRZjY1xO0tmdvuqOhuKjuEGj84cdAscimjoC1gu6Ah1F9T1uepddqaq2t0PQRwMqswf2107ebg/s1600/user%20(1).png"
          alt="Account"
        />
        <p>Account</p>
      </a>
    </footer>

    <script>
      // Workers data
      const workers = [
        {
          id: 1,
          name: "Michael Cruz",
          lat: 14.5995,
          lng: 120.9842,
          job: "Carpentry",
          location: "Manila",
          profileUrl: "/dist/users/service-details.html",
        },
        {
          id: 2,
          name: "Lito Vargas",
          lat: 14.64571,
          lng: 121.03071,
          job: "Carpentry",
          location: "Quezon City",
          profileUrl: "/dist/users/service-lito.html",
        },
        {
          id: 3,
          name: "Francis Dayuno",
          lat: 14.64853,
          lng: 121.02539,
          job: "Plumber",
          location: "Quezon City",
          profileUrl: "/dist/users/service-francis.html",
        },
        {
          id: 4,
          name: "Rohann Dranto",
          lat: 14.60236,
          lng: 120.99483,
          job: "Plumber",
          location: "Manila",
          profileUrl: "/dist/users/service-rohann.html",
        },
        {
          id: 5,
          name: "Jason Maracha",
          lat: 14.44436,
          lng: 120.95033,
          job: "Electrician",
          location: "Bacoor",
          profileUrl: "/dist/users/service-jason.html",
        },
        {
          id: 6,
          name: "Ronald Reyes",
          lat: 14.5997,
          lng: 120.9829,
          job: "Repair",
          location: "Manila",
          profileUrl: "/dist/users/service-ronald.html",
        },
        {
          id: 7,
          name: "Marian De Guzman",
          lat: 14.64704,
          lng: 120.97836,
          job: "Repair",
          location: "Caloocan City",
          profileUrl: "/dist/users/service-marian.html",
        },
        {
          id: 8,
          name: "Aubrey Ragandan",
          lat: 14.63524,
          lng: 121.01698,
          job: "Repair",
          location: "Quezon City",
          profileUrl: "/dist/users/service-aubrey.html",
        },
        {
          id: 8,
          name: "Bong Aquino",
          lat: 14.58591,
          lng: 120.99861,
          job: "Painting",
          location: "Quezon City",
          profileUrl: "/dist/users/service-bong.html",
        },
        {
          id: 9,
          name: "Jose Manlangit",
          lat: 14.58956,
          lng: 121.00513,
          job: "Carpentry",
          location: "Manila",
          profileUrl: "/dist/users/service-jose.html",
        },
        {
          id: 10,
          name: "Toni Morales",
          lat: 14.54653,
          lng: 120.99998,
          job: "Carpentry",
          location: "Pasay",
          profileUrl: "/dist/users/service-toni.html",
        },
        {
          id: 11,
          name: "Vic Torres",
          lat: 14.54608,
          lng: 121.01097,
          job: "Carpentry",
          location: "Pasay",
          profileUrl: "/dist/users/service-vic.html",
        },
        {
          id: 12,
          name: "Joey Cortez",
          lat: 14.57777,
          lng: 120.99209,
          job: "Carpentry",
          location: "Manila",
          profileUrl: "/dist/users/service-joey.html",
        },
        {
          id: 13,
          name: "Justin Balingit",
          lat: 14.58956,
          lng: 121.00513,
          job: "Plumber",
          location: "Manila",
          profileUrl: "/dist/users/service-justin.html",
        },
        {
          id: 14,
          name: "Jacob Lopez",
          lat: 14.54653,
          lng: 120.99998,
          job: "Plumber",
          location: "Pasay",
          profileUrl: "/dist/users/service-jacob.html",
        },
        {
          id: 15,
          name: "Rodel De Jesus",
          lat: 14.60186,
          lng: 120.9787,
          job: "Plumber",
          location: "Manila",
          profileUrl: "/dist/users/service-rodel.html",
        },
        {
          id: 16,
          name: "Mariel Mariano",
          lat: 14.57777,
          lng: 120.99209,
          job: "Plumber",
          location: "Manila",
          profileUrl: "/dist/users/service-mariel.html",
        },
        {
          id: 17,
          name: "Shanne Dugang",
          lat: 14.57577,
          lng: 120.99209,
          job: "Electrician",
          location: "Manila",
          profileUrl: "/dist/users/service-shanne.html",
        },
        {
          id: 18,
          name: "Miguel Severino",
          lat: 14.58556,
          lng: 121.00513,
          job: "Electrician",
          location: "Manila",
          profileUrl: "/dist/users/service-miguel.html",
        },
        {
          id: 19,
          name: "Rhoda Lyn",
          lat: 14.54653,
          lng: 120.99998,
          job: "Electrician",
          location: "Pasay",
          profileUrl: "/dist/users/service-rhoda.html",
        },
        {
          id: 20,
          name: "Benjamin Santos",
          lat: 14.61186,
          lng: 120.9787,
          job: "Electrician",
          location: "Manila",
          profileUrl: "/dist/users/service-benjamin.html",
        },
        {
          id: 21,
          name: "Patrick Guzman",
          lat: 14.64189,
          lng: 121.05028,
          job: "Electrician",
          location: "Manila",
          profileUrl: "/dist/users/service-patrick.html",
        },
        {
          id: 22,
          name: "Nong Manalo",
          lat: 14.50848,
          lng: 120.98977,
          job: "Repair",
          location: "Parañaque City",
          profileUrl: "/dist/users/service-nong.html",
        },
        {
          id: 23,
          name: "Warren Reyes",
          lat: 14.57719,
          lng: 120.99029,
          job: "Repair",
          location: "Manila",
          profileUrl: "/dist/users/service-warren.html",
        },
        {
          id: 24,
          name: "Erick Valenciano",
          lat: 14.59255,
          lng: 120.98857,
          job: "Repair",
          location: "Manila",
          profileUrl: "/dist/users/service-erick.html",
        },
        {
          id: 25,
          name: "Gary Gomez",
          lat: 14.61186,
          lng: 120.9787,
          job: "Painting",
          location: "Manila",
          profileUrl: "/dist/users/service-gary.html",
        },
        {
          id: 26,
          name: "Oweng Chavez",
          lat: 14.54969,
          lng: 120.99363,
          job: "Painting",
          location: "Pasay",
          profileUrl: "/dist/users/service-oweng.html",
        },
        {
          id: 27,
          name: "Rene Regelado",
          lat: 14.45596,
          lng: 120.96136,
          job: "Painting",
          location: "Bacoor City",
          profileUrl: "/dist/users/service-rene.html",
        },
        {
          id: 28,
          name: "Emer Decena",
          lat: 14.57918,
          lng: 120.98042,
          job: "Painting",
          location: "Manila",
          profileUrl: "/dist/users/service-emer.html",
        },
        {
          id: 29,
          name: "Anton Reyes",
          lat: 14.59239,
          lng: 120.97758,
          job: "Painting",
          location: "Manila",
          profileUrl: "/dist/users/service-anton.html",
        },
      ];

      // Initialize the map
      const map = L.map("map").setView([0, 0], 2);
      L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);

      // Store markers globally
      let workerMarkers = [];

      // Function to create markers and add them to the map initially
      function createWorkerMarkers() {
        workers.forEach((worker) => {
          const marker = L.marker([worker.lat, worker.lng]);
          marker.bindPopup(`
      <div>
        <h3>${worker.name}</h3>
        <p><a href="${worker.profileUrl}" target="_blank">${worker.job}</a></p>
        <p>${worker.location}</p>
      </div>
    `);
          workerMarkers.push({ marker, job: worker.job.toLowerCase() });
          marker.addTo(map); // Show all markers initially
        });
      }

      // Hide all markers
      function hideAllMarkers() {
        workerMarkers.forEach(({ marker }) => {
          map.removeLayer(marker);
        });
      }

      // Show markers that match the job
      function showMatchingMarkers(jobSearch) {
        workerMarkers.forEach(({ marker, job }) => {
          if (job.includes(jobSearch.toLowerCase())) {
            marker.addTo(map);
          } else {
            map.removeLayer(marker);
          }
        });
      }

      // Event listener for search input
      document
        .getElementById("workerSearch")
        .addEventListener("keydown", function (event) {
          if (event.key === "Enter") {
            findWorker();
          }
        });

      // Search functionality
      function findWorker() {
        const searchInput = document
          .getElementById("workerSearch")
          .value.trim();
        if (searchInput) {
          hideAllMarkers();
          showMatchingMarkers(searchInput);
        } else {
          alert("Please enter a job to search.");
        }
      }

      // Create worker markers on page load
      createWorkerMarkers();

      // Geolocation for user's location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;
            map.setView([userLat, userLng], 14);
            L.marker([userLat, userLng])
              .addTo(map)
              .bindPopup("<b>You are here</b>")
              .openPopup();
          },
          (error) => {
            console.error("Error getting location:", error.message);
            alert("Unable to retrieve your location.");
          }
        );
      } else {
        alert("Geolocation is not supported by your browser.");
      }
    </script>
  </body>
</html>
